<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Arduino Serial Logger</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 10px;
            background: #f4f4f4;
        }

        h1 {
            font-size: 20px;
        }

        #data {
            height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }

        #controls {
            margin-bottom: 10px;
        }

        button.menu {
            margin-right: 10px;
            padding: 8px 12px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <h1>Arduino Serial Logger</h1>

    <div id="controls">
        <button id="saveCsv" class="menu">Save CSV As</button>
        <button id="browseCsv" class="menu">Browse & Save CSV</button>
        <button id="editHeaders" class="menu">Edit Headers</button>
        <button id="resetHeaders" class="menu">Reset Headers</button>
    </div>

    <h2>Logs
        <button id="toggleLive">Toggle Live Data</button>
        <button id="open-last-scanned">Show Last Scanned</button>
    </h2>
    <div id="data">Waiting for data...</div>

    <script>
        const { ipcRenderer } = require('electron');

        const logEl = document.getElementById('log');
        const dataEl = document.getElementById('data');
        const lastDataEl = document.getElementById('lastData');

        ipcRenderer.on('log', (_, messages) => {
            logEl.textContent = messages.join('\n');
            logEl.scrollTop = logEl.scrollHeight;
        });

        ipcRenderer.on('data', (_, data) => {
            dataEl.textContent += data + '\n';
            dataEl.scrollTop = dataEl.scrollHeight;
            lastDataEl.textContent = data.trim().replace(/^.*?\|/, '').trim();
        });

        document.getElementById('open-last-scanned').addEventListener('click', () => {
            ipcRenderer.invoke('open-last-scanned-window');
        });

        document.getElementById('saveCsv').onclick = async () => {
            const result = await ipcRenderer.invoke('save-csv-as');
            alert(result.success ? `CSV saved to:\n${result.filePath}` : `Error:\n${result.error}`);
        };

        document.getElementById('browseCsv').onclick = async () => {
            const result = await ipcRenderer.invoke('browse-and-save-csv');
            alert(result.success ? `Saved ${result.originalFile} to:\n${result.filePath}` : `Error:\n${result.error}`);
        };

        document.getElementById('editHeaders').onclick = () => {
            ipcRenderer.invoke('open-header-editor');
        };

        document.getElementById('resetHeaders').onclick = async () => {
            if (confirm('Reset headers to default?')) {
                await ipcRenderer.invoke('reset-headers');
                alert('Headers reset.');
            }
        };

        document.getElementById('toggleLive').onclick = () => {
            dataEl.classList.toggle('hidden');
        };
    </script>
</body>

</html>